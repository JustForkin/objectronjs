/*! objectron - v0.0.1 - 2014-03-26
 * https://github.com/axelpale/objectronjs
 *
 * Copyright (c) 2014 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b={},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)},d=function(a){return"string"==typeof a||"number"==typeof a?[a]:c(a)?a:[]},e=function(a,b){return Math.random()*(b-a)+a};b.util={isArray:c,toArray:d,randomFromInterval:e},b.adaptingCategoricalDistribution=function(){var a={},b=function(a,b){var c,d,e,f,g,h,i;if(c=a.state,d=c.indices[b],e=c.counters[b],g=d===c.order.length-1,h=0===d,f=g?!0:h?!1:c.counters[c.order[d-1]]<e?!0:!1)for(;0!==d&&c.counters[c.order[d-1]]<=e;)i=c.order[d-1],c.order[d]=i,c.order[d-1]=b,c.indices[i]=d,d-=1;else for(;d!==c.order.length-1&&c.counters[c.order[d+1]]>e;)i=c.order[d+1],c.order[d]=i,c.order[d+1]=b,c.indices[i]=d,d+=1;c.indices[b]=d},c=function(a){"number"!=typeof a&&(a=0),this.state={counters:{},countersSum:0,maxSize:a,order:[],indices:{}}};return a.create=function(a){return new c(a)},c.prototype.prob=function(a){var b,c,d,e=[];for(b=0;b<a.length;b+=1)c=a[b],this.state.counters.hasOwnProperty(c)?(d=this.state.counters[c]/this.state.countersSum,e.push(d)):e.push(0);return e},c.prototype.head=function(a){var b=this.state;return"number"!=typeof a&&(a=0),a=Math.min(a,b.order.length),a>0?b.order.slice(0,a):0===a?b.order.slice(0):[]},c.prototype.peak=function(a){var b,c,d,e=this.state;if(0===e.order.length)return[];for(c=e.counters[e.order[0]],d=c-c*a,b=1;b<e.order.length&&!(d>e.counters[e.order[b]]);b+=1);return e.order.slice(0,b)},c.prototype.subset=function(a){var b,d,e,f,g=this.state;for(e=new c(g.maxSize),f=e.state,b=0;b<a.length;b+=1)d=a[b],g.counters.hasOwnProperty(d)&&(f.counters[d]=g.counters[d],f.countersSum+=g.counters[d]);for(b=0;b<g.order.length;b+=1)d=g.order[b],f.counters.hasOwnProperty(d)&&(f.order.push(d),f.indices[d]=f.order.length-1);return e},c.prototype.rank=function(a){var b,c,d=[],e=this.state;for(b=0;b<a.length;b+=1)c=a[b],d.push(e.indices.hasOwnProperty(c)?e.indices[c]:1/0);return d},c.prototype.sample=function(a){var b,c,d,f,g=[],h=this.state;if("number"!=typeof a&&(a=1),0===h.order.length||0>=a)return g;for(c=0;a>c;c+=1)for(b=e(0,h.countersSum),f=0,d=0;d<h.order.length;d+=1)if(f+=h.counters[h.order[d]],f>b){g.push(h.order[d]);break}return g},c.prototype.size=function(){return this.state.countersSum},c.prototype.numCategories=function(){return this.state.order.length},c.prototype.dump=function(){var a,b,c,d=this.state,e=[];for(a=0;a<d.order.length;a+=1)b=d.order[a],c=d.counters[b],e.push(b),e.push(c);return e.push(d.maxSize),e},c.prototype.copy=function(){var a=new c;return a.load(this.dump()),a},c.prototype.learn=function(a){var c,d,e=this.state;for(c=0;c<a.length;c+=1)e.maxSize>0&&e.countersSum+1>e.maxSize&&this.unlearn(this.sample()),d=a[c],e.counters.hasOwnProperty(d)?e.counters[d]+=1:(e.counters[d]=1,e.order.push(d),e.indices[d]=e.order.length-1),e.countersSum+=1,b(this,d);return this},c.prototype.unlearn=function(a){var c,d,e=this.state;for(c=0;c<a.length;c+=1)d=a[c],e.counters.hasOwnProperty(d)&&(e.counters[d]-=1,e.countersSum-=1,b(this,d),e.counters[d]<=0&&(e.order.pop(),delete e.counters[d],delete e.indices[d]));return this},c.prototype.maxSize=function(a){var b,c;if("number"!=typeof a)return this.state.maxSize;if(b=this.state.countersSum-a,b>0)for(c=0;c<Math.ceil(b);c+=1)this.unlearn(this.sample());this.state.maxSize=a},c.prototype.load=function(a){var b,c,d,e;for(e={counters:{},countersSum:0,maxSize:0,order:[],indices:{}},b=0;b+1<a.length;b+=2)c=a[b],d=a[b+1],e.counters[c]=d,e.countersSum+=d,e.order.push(c),e.indices[c]=e.order.length-1;return e.maxSize=a[b],this.state=e,this},a}(),b.unigram=function(){var a={},b=function(){var a={},b=0,c={},d=[],f={},g=function(b,e){var f,g,h,i,j=-1,k=1;for(e!==j&&e!==k&&(e=j);;){if(f=c[b]+e,!(f>=0&&f<d.length))break;if(g=d[f],h=a[g],i=a[b],e===j&&h>i||e===k&&i>=h)break;d[f]=b,c[b]=f,d[f-e]=g,c[g]=f-e}};return f.add=function(e){a.hasOwnProperty(e)?a[e]+=1:(a[e]=1,d.push(e),c[e]=d.length-1),b+=1,g(e,-1)},f.subtract=function(c){a.hasOwnProperty(c)&&(a[c]<=0||(a[c]-=1,b-=1,g(c,1)))},f.prob=function(c){return a.hasOwnProperty(c)?a[c]/b:0},f.top=function(a){return"number"!=typeof a&&(a=0),a=Math.min(a,d.length),a>0?d.slice(0,a):0===a?d.slice(0):[]},f.topTolerated=function(a){var b,c,e,f;if(0===d.length)return[];if(1===d.length)return d.slice(0);for(c=d[0],e=this.prob(c),f=e-e*a,b=1;b<d.length&&f<=this.prob(d[b]);)b+=1;return d.slice(0,b)},f.topSubsetTolerated=function(a,b){var c,d,e,f,g,h,i,j;for(f=[],g=0,c=0;c<a.length;c+=1)d=this.prob(a[c]),f.push(d),d>g&&(g=d);for(h=g-g*b,i=[],j={},c=0;c<a.length;c+=1)d=f[c],e=a[c],d>=h&&(i.push(e),j[e]=d);return i.sort(function(a,b){var c=j[a],d=j[b];return c>d?-1:1}),i},f.rank=function(a){return c.hasOwnProperty(a)?c[a]:1/0},f.sample=function(){var c,f,g;for(c=e(0,b),g=0,f=0;f<d.length;f+=1)if(g+=a[d[f]],g>c)return d[f];return null},f.size=function(){return d.length},f.dump=function(){return a},f.load=function(e){var f;a={},d=[],c={},b=0;for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f],b+=e[f],d.push(f),c[f]=d.length-1,g(f,-1))},f};return a.create=function(){return b()},a}(),b.ngramnode=function(){var a={},c=function(){var a={},e=b.unigram.create(),f={};return a.prob=function(a){if(a=d(a),a.length<=0)return 1;var b=a[0],c=a.slice(1);return f.hasOwnProperty(b)?e.prob(b)*f[b].prob(c):0},a.given=function(a){if(a=d(a),a.length<=0)return this;var b=a[0],e=a.slice(1);return f.hasOwnProperty(b)||(f[b]=c()),f[b].given(e)},a.top=function(a,b){if("number"!=typeof b&&(b=0),a=d(a),a.length<=0)return e.top(b);var c=a[0],g=a.slice(1);return f.hasOwnProperty(c)?f[c].top(g,b):[]},a.topTolerated=function(a,b){if(a=d(a),a.length<=0)return e.topTolerated(b);var c=a[0],g=a.slice(1);return f.hasOwnProperty(c)?f[c].topTolerated(g,b):[]},a.topSubsetTolerated=function(a,b,c){if(a=d(a),b=d(b),a.length<=0)return e.topSubsetTolerated(b,c);var g=a[0],h=a.slice(1);return f.hasOwnProperty(g)?f[g].topSubsetTolerated(h,b,c):[]},a.add=function(a){if(a=d(a),!(a.length<=0)){var b=a[0],g=a.slice(1);e.add(b),f.hasOwnProperty(b)||(f[b]=c()),f[b].add(g)}},a.subtract=function(a){if(a=d(a),!(a.length<=0)){var b=a[0],g=a.slice(1);e.subtract(b),f.hasOwnProperty(b)||(f[b]=c()),f[b].subtract(g)}},a.dump=function(){var a,b={};for(a in f)f.hasOwnProperty(a)&&(b[a]=f[a].dump());return{histogram:e.dump(),children:b}},a.load=function(a){var b;e.load(a.histogram);for(b in a.children)a.children.hasOwnProperty(b)&&(f[b]=c(),f[b].load(a.children[b]))},a};return a.create=function(){return c()},a}(),b.objectron=function(){var a,d={},e=Math.pow(2,50);return a=function(a){"number"!=typeof a&&(a=e),this.historySize=a,this.root=b.ngramnode.create(),this.history=[]},d.create=function(b){return new a(b)},a.prototype.prob=function(a,b){return"string"==typeof a?a=[a]:"undefined"==typeof a&&(a=[]),"string"==typeof b?b=[b]:"undefined"==typeof b&&(b=[]),this.root.given(b).prob(a)},a.prototype.top=function(){throw"not implemented"},a.prototype.topSingle=function(){var a,b,c,d,e=.2;for(d=null,a=0;a<=this.history.length;a+=1){if(b=this.history.slice(a),c=this.root.given(b),d=null===d?c.topTolerated([],e):c.topSubsetTolerated([],d,e),1===d.length)return d.slice(0,1);0===d.length&&(d=null)}var f=null===d;return f?[]:d.slice(0,1)},a.prototype.dump=function(){return{historySize:this.historySize,history:this.history,root:this.root.dump()}},a.prototype.push=function(a){var b,d;if(c(a)){if(a.length<=0)return;b=a.slice(0,-1),d=a[a.length-1],this.push(b),a=d}var e,f;for(e=0;e<=this.history.length;e+=1)f=this.history.slice(e),this.root.given(f).add(a);this.history.length>=this.historySize&&this.history.shift(),this.history.push(a)},a.prototype.load=function(a){this.historySize=a.historySize,this.history=a.history,this.root.load(a.root)},d.extension=a.prototype,d}(),b.version="0.0.1","object"==typeof module&&"object"==typeof module.exports?module.exports=b:a.objectron=b}(this);
//# sourceMappingURL=objectron.min.map