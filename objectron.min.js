/*! objectron - v0.0.1 - 2014-03-10
 * https://github.com/axelpale/objectronjs
 *
 * Copyright (c) 2014 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b={},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.unigram=function(){var a={},b=function(){var a={},b=0,c={},d=[],e={},f=function(b,e){var f,g,h,i,j=-1,k=1;for(e!==j&&e!==k&&(e=j);;){if(f=c[b]+e,!(f>=0&&f<d.length))break;if(g=d[f],h=a[g],i=a[b],e===j&&h>i||e===k&&i>=h)break;d[f]=b,c[b]=f,d[f-e]=g,c[g]=f-e}};return e.add=function(e){a.hasOwnProperty(e)?a[e]+=1:(a[e]=1,d.push(e),c[e]=d.length-1),b+=1,f(e,-1)},e.subtract=function(c){a.hasOwnProperty(c)&&(a[c]<=0||(a[c]-=1,b-=1,f(c,1)))},e.prob=function(c){return a.hasOwnProperty(c)?a[c]/b:0},e.top=function(a){return"number"!=typeof a&&(a=0),a=Math.min(a,d.length),a>0?d.slice(0,a):0===a?d.slice(0):[]},e.topTolerated=function(a){var b,c,e,f;if(0===d.length)return[];if(1===d.length)return d.slice(0);for(c=d[0],e=this.prob(c),f=e-e*a,b=1;b<d.length&&f<=this.prob(d[b]);)b+=1;return d.slice(0,b)},e.topSubsetTolerated=function(a,b){var c,d,e,f,g,h,i;for(f=[],g=0,c=0;c<a.length;c+=1)d=this.prob(a[c]),f.push(d),d>g&&(g=d);for(h=[],i={},c=0;c<a.length;c+=1)d=f[c],e=a[c],d>g-g*b&&(h.push(e),i[e]=d);return h.sort(function(a,b){var c=i[a],d=i[b];return c>d?-1:1}),h},e.rank=function(a){return c.hasOwnProperty(a)?c[a]:1/0},e.size=function(){return d.length},e.dump=function(){return a},e.load=function(e){var g;a={},d=[],c={},b=0;for(g in e)e.hasOwnProperty(g)&&(a[g]=e[g],b+=e[g],d.push(g),c[g]=d.length-1,f(g,-1))},e};return a.create=function(){return b()},a}(),b.ngramnode=function(){var a={},d=function(){var a={},e=b.unigram.create(),f={};return a.prob=function(a){if("string"==typeof a&&(a=[a]),!c(a))throw"error";if(a.length<=0)return 1;var b=a[0],d=a.slice(1);return f.hasOwnProperty(b)?e.prob(b)*f[b].prob(d):0},a.given=function(a){if("string"==typeof a&&(a=[a]),!c(a))throw"error";if(a.length<=0)return this;var b=a[0],e=a.slice(1);return f.hasOwnProperty(b)||(f[b]=d()),f[b].given(e)},a.topTolerated=function(a,b){if("string"==typeof a&&(a=[a]),"undefined"==typeof a&&(a=[]),!c(a))throw"error";if(a.length<=0)return e.topTolerated(b);var d=a[0],g=a.slice(1);return f.hasOwnProperty(d)?f[d].topTolerated(g,b):[]},a.top=function(a,b){if("number"!=typeof b&&(b=0),"string"==typeof a&&(a=[a]),"undefined"==typeof a&&(a=[]),!c(a))throw"error";if(a.length<=0)return e.top(b);var d=a[0],g=a.slice(1);return f.hasOwnProperty(d)?f[d].top(g,b):[]},a.add=function(a){if("string"==typeof a&&(a=[a]),!c(a))throw"error";if(!(a.length<=0)){var b=a[0],g=a.slice(1);e.add(b),f.hasOwnProperty(b)||(f[b]=d()),f[b].add(g)}},a.subtract=function(a){if("string"==typeof a&&(a=[a]),!c(a))throw"error";if(!(a.length<=0)){var b=a[0],g=a.slice(1);e.subtract(b),f.hasOwnProperty(b)||(f[b]=d()),f[b].subtract(g)}},a.dump=function(){var a,b={};for(a in f)f.hasOwnProperty(a)&&(b[a]=f[a].dump());return{histogram:e.dump(),children:b}},a.load=function(a){var b;e.load(a.histogram);for(b in a.children)a.children.hasOwnProperty(b)&&(f[b]=d(),f[b].load(a.children[b]))},a};return a.create=function(){return d()},a}(),b.objectron=function(){var a,d={},e=Math.pow(2,50);return a=function(a){"number"!=typeof a&&(a=e),this.historySize=a,this.root=b.ngramnode.create(),this.history=[]},d.create=function(b){return new a(b)},a.prototype.prob=function(a,b){return"string"==typeof a?a=[a]:"undefined"==typeof a&&(a=[]),"string"==typeof b?b=[b]:"undefined"==typeof b&&(b=[]),this.root.given(b).prob(a)},a.prototype.dump=function(){return{historySize:this.historySize,history:this.history,root:this.root.dump()}},a.prototype.push=function(a){var b,d;if(c(a)){if(a.length<=0)return;b=a.slice(0,-1),d=a[a.length-1],this.push(b),a=d}var e,f;for(e=0;e<=this.history.length;e+=1)f=this.history.slice(e),this.root.given(f).add(a);this.history.length>=this.historySize&&this.history.shift(),this.history.push(a)},a.prototype.load=function(a){this.historySize=a.historySize,this.history=a.history,this.root.load(a.root)},d.extension=a.prototype,d}(),b.version="0.0.1","object"==typeof module&&"object"==typeof module.exports?module.exports=b:a.objectron=b}(this);
//# sourceMappingURL=objectron.min.map